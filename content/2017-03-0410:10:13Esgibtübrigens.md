Es gibt übrigens inzwischen eine plausible Theorie \...
=======================================================

Date: 2017-03-04 10:10:13

Es gibt übrigens inzwischen eine plausible Theorie dafür, wieso Ryzen
bei Single-Threading zurück fällt. Und zwar haben die jetzt
vorgestellten Ryzen-Prozessoren 8 Kerne haben, aber nicht 8 symmetrische
Kerne an einem Bus, sondern zwei \"CPU Complex\" (CCX) mit je vier
Kernen. Die Kerne sind zwar immer noch gleich stark, egal in welchem CCX
die sind, aber Kommunikation zwischen den CCX ist halt deutlich
langsamer als innerhalb eines CCX.

Damit ist der Ryzen sozusagen NUMA-on-a-chip.

Wenn man einen Multicore unter Windows betreibt, aber nur auf einem Core
richtig Last fährt, dann schiebt Windows die Last immer im Kreis
zwischen den Cores. Die Idee dabei ist, dass nicht ein Kern die ganze
Last abkriegt und dann zu heiß wird. So kann man Materialermüdung
vorbeugen und der Kühler muss möglicherweise weniger schnell drehen und
schrill pfeifen. Ist an sich eine gute Idee, aber wenn Windows jetzt von
einem Kern in der 1. Gruppe auf einen Kern in der 2. Gruppe schaltet,
dann kostet das eben Performance.

An sich kann das Betriebssystem das auch wissen, wenn es NUMA-aware ist,
aber da hinkt Windows schon länger deutlich hinterher. Womöglich hat AMD
hier auch irgendwas subtil anders gemacht, dass die NUMA-Erkennung nicht
anschlägt. Wer weiß. Das wäre jedenfalls eine Erklärung.

Und das heißt auch, wenn Microsoft ein Update shippt, und das werden sie
zeitnah, dass dann das Problem weggeht. Man könnte das mal ausprobieren,
wenn man einen Ryzen hat, indem man eine Single-Core-Anwendung per
Prozessoraffinität auf einen Core festnagelt.
