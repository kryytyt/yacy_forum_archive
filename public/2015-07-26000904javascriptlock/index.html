<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.37.1" />
  <title> &middot; Yacy Old Forum Archiv</title>
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->
  <link rel="stylesheet" href="/css/blackburn.css">
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
  
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
  
  
</head>
<body>
<div id="layout">
  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">
  
  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>
  <div class="pure-menu social">
  <ul class="pure-menu-list">
    
    
    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/http://twitter.com/yacy_search" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yacy" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>
  <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>
</div>
  <div id="main">
<div class="header">
  <h1></h1>
  <h2></h2>
</div>
<div class="content">
  
<h1 id="javascript-locking-and-sound-brought-to-you-by-the-letters-w-t-and-f">Javascript, locking and sound, brought to you by the letters W, T and F</h1>
<p>Date: 2015-07-26 00:09:04</p>
<p><img src="http://www.dnalounge.com/backstage/log/2005/10/fuck-alsa.gif" alt="" />The
Javascript party line is that you don\&rsquo;t need locking, because no
threads, no safety, no problem: every window or tab has its own
Javascript context, and that context is guaranteed to behave as if it is
single-threaded: sequential execution, timers fire on return to the
event loop, processes cannot communicate with each other.</p>
<p>Except then they added localStorage. Oh, what\&rsquo;s this? Is it shared
memory that can be accessed asynchronously by multiple contexts? Why yes
it is! So now you really do need locking. Except then they didn\&rsquo;t add
mutexes, or even an atomic-read-and-increment operator. Hooray. And they
also didn\&rsquo;t add any IPC, like a socket that one process can write to
and that others can select() on. Hooray.</p>
<p>So let\&rsquo;s say you\&rsquo;ve got an app, it spans multiple documents, and you
want a sound to play in reaction to some external, asynchronous event if
any of your documents are open. But if three windows are open, you only
want that sound to play once per event. The obvious way to do this is to
nominate one of those documents as the leader, and pass the conch to
someone else if the leader document goes away.</p>
<p>Well, good luck with that, since you only have a shared whiteboard, not
real IPC. This means that <em>each</em> of your contexts needs to constantly
poll the whiteboard, doing something like, \&ldquo;Has it been too long since
the leader has updated their heartbeat timestamp? If so, now I must race
with my brethren to try and acquire the lock and become the leader.\&rdquo; So
aside from that being stupid -- all those timers, all that polling --
it\&rsquo;s also inefficient, because it means that there\&rsquo;s always an
interregnum during which there\&rsquo;s no leader (your polling interval). Try
to burn fewer cycles by increasing your polling interval and you
increase the window during which your asynchronous notifications can\&rsquo;t
happen.</p>
<p>What kind of Mickey Mouse operation is this? There was better
multitasking on MacOS 6.</p>
<p>Oh, and speaking of sound: on iOS, you flat-out cannot play sound unless
somewhere higher up on the call stack is a touch gesture. Asynchronous
sounds can\&rsquo;t be done using the HTML5 audio tag, because... Apple are
dicks, I guess? I\&rsquo;m gonna go with that. So apparently there\&rsquo;s a newer
and completely separate audio interface with a way more convoluted API,
and maybe <em>that</em> one works on iOS? But I haven\&rsquo;t investigated, having
at that point run out of fucks due to the fact that I was starting to
have ALSA versus OSS flashbacks and expecting it to tell me my EMU10K1
PCM setting was wrong.</p>
<p><a href="http://www.jwz.org/blog/2010/10/every-day-i-learn-something-new-and-stupid/">Previously</a>,
<a href="http://www.jwz.org/blog/2014/03/a-hate-flower-that-blooms-all-year-also-space-egyptians/">previously</a>,
<a href="http://www.jwz.org/blog/2013/10/w3c-green-lights-adding-drm-to-the-webs-standards/">previously</a>.</p>
</div>
</div>
</div>
<script src="js/ui.js"></script>
</body>
</html>
