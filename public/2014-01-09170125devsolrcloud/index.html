<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.37.1" />
  <title> &middot; Yacy Old Forum Archiv</title>
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->
  <link rel="stylesheet" href="/css/blackburn.css">
  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
  
  
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
  
  
</head>
<body>
<div id="layout">
  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">
  
  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>
  <div class="pure-menu social">
  <ul class="pure-menu-list">
    
    
    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/http://twitter.com/yacy_search" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/yacy" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>
  <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>
</div>
  <div id="main">
<div class="header">
  <h1></h1>
  <h2></h2>
</div>
<div class="content">
  
<h1 id="dev-solrcloud">Dev:SolrCloud</h1>
<p>Date: 2014-01-09 17:01:25</p>
<p>update</p>
<p>← Nächstältere Version</p>
<p>Version vom 9. Januar 2014, 16:01 Uhr</p>
<p>(Eine dazwischenliegende Version von einem Benutzer wird nicht
angezeigt)</p>
<p>Zeile 1:</p>
<p>Zeile 1:</p>
<p>−</p>
<div>
This is an advanced \[\[Dev:Solr Solr for YaCy\]\] installation which
uses the SolrCloud architecture. If you want to read and understand
this, you should be (at least a little bit) familiar with debian, Solr
and tomcat.
</div>
<p>+</p>
<div>
This is an advanced \[\[Dev:Solr[\|]{.underline}Solr for YaCy\]\]
installation which uses the SolrCloud architecture. If you want to read
and understand this, you should be (at least a little bit) familiar with
debian, Solr and tomcat.
</div>
<p> </p>
<p> </p>
<p> </p>
<div>
In this example, we install a shard of 4 Solr instances within the same
server.
</div>
<p> </p>
<div>
In this example, we install a shard of 4 Solr instances within the same
server.
</div>
<p> </p>
<p>+</p>
<div>
[=== Software Installation ===]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[We install tomcat, zookeeper and YaCy as standard debian packages and
Solr as web app for tomcat.]{.underline}
</div>
<p> </p>
<p> </p>
<p>−</p>
<div>
~~=~~==== Tomcat Installation ~~=~~====
</div>
<p>+</p>
<div>
==== Tomcat Installation ====
</div>
<p> </p>
<div>
We will install tomcat as a standard debian system service using apt:
</div>
<p> </p>
<div>
We will install tomcat as a standard debian system service using apt:
</div>
<p> </p>
<div>
  apt-get install tomcat6 tomcat6-examples tomcat6-admin tomcat6-docs
</div>
<p> </p>
<div>
  apt-get install tomcat6 tomcat6-examples tomcat6-admin tomcat6-docs
</div>
<p>Zeile 29:</p>
<p>Zeile 31:</p>
<p> </p>
<div>
  default web page: /var/lib/tomcat6/webapps/ROOT/index.html
</div>
<p> </p>
<div>
  default web page: /var/lib/tomcat6/webapps/ROOT/index.html
</div>
<p> </p>
<p> </p>
<p>−</p>
<div>
~~=~~==== Zookeeper Installation ~~=~~====
</div>
<p>+</p>
<div>
==== Zookeeper Installation ====
</div>
<p> </p>
<div>
The SolrCloud peers need a common configuration system which is provided
by zookeeper. Zookeeper can be installed with
</div>
<p> </p>
<div>
The SolrCloud peers need a common configuration system which is provided
by zookeeper. Zookeeper can be installed with
</div>
<p> </p>
<div>
  apt-get install zookeeper zookeeperd
</div>
<p> </p>
<div>
  apt-get install zookeeper zookeeperd
</div>
<p>Zeile 42:</p>
<p>Zeile 44:</p>
<p> </p>
<div>
  ls /zookeeper
</div>
<p> </p>
<div>
  ls /zookeeper
</div>
<p> </p>
<p> </p>
<p>−</p>
<div>
~~=~~==== Solr ~~and Zookeeper~~ Installation ~~=~~====
</div>
<p>+</p>
<div>
==== Solr Installation ====
</div>
<p> </p>
<div>
Download a solr release from http://lucene.apache.org/solr/ i.e.
</div>
<p> </p>
<div>
Download a solr release from http://lucene.apache.org/solr/ i.e.
</div>
<p> </p>
<div>
  cd /var/lib/tomcat6/
</div>
<p> </p>
<div>
  cd /var/lib/tomcat6/
</div>
<p>Zeile 48:</p>
<p>Zeile 50:</p>
<p> </p>
<div>
  tar xfz solr-4.6.0.tgz
</div>
<p> </p>
<div>
  tar xfz solr-4.6.0.tgz
</div>
<p> </p>
<div>
  cp solr-4.6.0/dist/solr-4.6.0.war webapps/
</div>
<p> </p>
<div>
  cp solr-4.6.0/dist/solr-4.6.0.war webapps/
</div>
<p>−</p>
<div>
~~Before~~ solr can be ~~fully deployed~~, we must ~~create~~ a solr
index schema. This ~~is taken~~ from YaCy  
</div>
<p>+</p>
<div>
[After the war-file is copied to webapps, tomcat automatically
decompresses the war file and writes the content to
/var/lib/tomcat6/webapps/]{.underline}solr[-4.6.0. Check that this
exists.]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[Because Solr uses a different logging in jetty as implemented in solr,
we must copy the logging libraries to tomcat as well:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[cp /var/lib/tomcat6/solr-4.6.0/example/lib/ext/\*
/usr/share/tomcat6/lib/]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[and restart tomcat:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[/etc/init.d/tomcat6 restart]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[==== YaCy Installation ====]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[Follow the
\[\[En:DebianInstall\#Installation\_of\_YaCy\_on\_Debian\|YaCy for
Debian installation instructions\]\] and select \'webportal\' as network
to join into (we consider that you do this not create a standalone-YaCy,
not a peer-to-peer participant; you]{.underline} can [of course also use
this for a \'freeworld\' peer as well). The relevant paths are
at]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[YaCy data:          /var/lib/yacy]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[YaCy log:          /var/log/yacy]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[YaCy binary:        /usr/share/yacy/]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[Solr conf for YaCy: /usr/share/yacy/defaults/solr]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[=== Software Configuration ===]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[The SolrCloud needs a common configuration of the index cores used by
YaCy. YaCy uses two cores, \'collection1\' and \'webgraph\'. Both are
defined with a generic index schema and they are exact clones of each
other. It may]{.underline} be [also possible to defines these cores with
non-generic]{.underline}, [exact defined schema.xml files,
but]{.underline} we [will not do that right now because it makes things
much more complex.]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[==== Zookeeper Client for Solr ====]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[First, we need a Zookeeper client for Solr because Solr provides it\'s
own client app to upload the relevant configuration files.
We]{.underline} must [fabricate this client using the libraries inside
the Solr war-file and additional libraries for logging. We use the
already installed war file, you must adopt the paths here if you
used]{.underline} a [more recent version of Solr:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[apt-get install unzip \# a war file is in zip file format; we need that
to get the \'inside\' of the war file]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[unzip -q /var/lib/tomcat6/webapps/]{.underline}solr[-4.6.0.war -d
/tmp/solr-war/]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[mkdir /usr/share/zookeeper/solr-cli-lib]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[cp /tmp/solr-war/WEB-INF/lib/\* /usr/share/zookeeper/solr-cli-lib/ \#
solr libs]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[cp /var/lib/tomcat6/solr-4.6.0/example/lib/ext/\*
/usr/share/zookeeper/solr-cli-lib/ \# logger libs]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[rm -Rf /tmp/solr-war]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[Now we can take advantage of the SolrCloud ZooKeeper CLI
commands.]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[==== Create Solr Configuration of Solr Cores for YaCy Inside Zookeeper
====]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[We need a storage place for the YaCy index data, generated by Solr and
a location to fabricate a default]{.underline} index schema [for
Solr]{.underline}. This [shall be placed in
/var/lib/tomcat6/yacyindex:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[mkdir /var/lib/tomcat6/yacyindex]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[For a detailed description of the set-up of Solr Clusters and a
SolrCloud configuration, see the
\[\[http://wiki.apache.org/solr/SolrCloud SolrCloud Wiki of
apache.org\]\], the \[\[http://wiki.apache.org/solr/SolrCloudTomcat
SolrCloud Installation in Tomcat\]\], a
\[\[http://systemsarchitect.net/painless-guide-to-solr-cloud-configuration/
Guide to SolrCloud Configuration\]\] and a
\[\[http://myjeeva.com/solrcloud-cluster-single-collection-deployment.html
SolrCloud Cluster (Single Collection) Deployment\]\].]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[To upload the solr configuration in Zookeeper, we prepare a
configuration template for the two cores we want. We make a directory to
hold these templates using the example solr configuration:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[cp -R /var/lib/tomcat6/solr-4.6.0/example/solr
/var/lib/tomcat6/yacyindex/solr-config]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[then patch this with the generic YaCy schema.xml:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[cp /usr/share/yacy/defaults/solr/schema.xml
/var/lib/tomcat6/yacyindex/solr-config/collection1/conf/]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[Clone the collection1 to get the webgraph core:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[cp -R /var/lib/tomcat6/yacyindex/solr-config/collection1
/var/lib/tomcat6/yacyindex/solr-config/webgraph]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[and patch the file
/var/lib/tomcat6/yacyindex/solr-config/webgraph/core.properties where
you replace the word \'collection1\' with \'webgraph\'.]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[We can now upload the generic solr config]{.underline} from
YaCy[:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[java -classpath .:/usr/share/zookeeper/solr-cli-lib/\*
org.apache.solr.cloud.ZkCLI -zkhost localhost:2181 -cmd upconfig
-confdir /usr/share/yacy/defaults/solr -confname
yacygeneric]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[That configuration is good for both collections, \'collection1\' and
\'webgraph\'. We can link this configuration therefore to both
collections:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[java -classpath .:/usr/share/zookeeper/solr-cli-lib/\*
org.apache.solr.cloud.ZkCLI -zkhost localhost:2181 -cmd linkconfig
-collection collection1 -confname yacygeneric]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[java -classpath .:/usr/share/zookeeper/solr-cli-lib/\*
org.apache.solr.cloud.ZkCLI -zkhost localhost:2181 -cmd linkconfig
-collection webgraph -confname yacygeneric]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[Other option (maybe does not work):]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[java -classpath .:/usr/share/zookeeper/solr-cli-lib/\*
org.apache.solr.cloud.ZkCLI -zkhost localhost:2181 -cmd upconfig
-confdir /var/lib/tomcat6/yacyindex/solr-config/collection1 -confname
generic\_collection1]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[java -classpath .:/usr/share/zookeeper/solr-cli-lib/\*
org.apache.solr.cloud.ZkCLI -zkhost localhost:2181 -cmd upconfig
-confdir /var/lib/tomcat6/yacyindex/solr-config/webgraph -confname
generic\_webgraph]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[We can link these configurations to the collections:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[java -classpath .:/usr/share/zookeeper/solr-cli-lib/\*
org.apache.solr.cloud.ZkCLI -zkhost localhost:2181 -cmd linkconfig
-collection collection1 -confname generic\_collection1]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[java -classpath .:/usr/share/zookeeper/solr-cli-lib/\*
org.apache.solr.cloud.ZkCLI -zkhost localhost:2181 -cmd linkconfig
-collection webgraph -confname generic\_webgraph]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[Lets see whats inside of zookeeper now, i.e. how the collection1 is
linked against the generic schema:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[/usr/share/zookeeper/bin/zkCli.sh get
/collections/collection1]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
 
</div>
<p> </p>
<p>+</p>
<div>
[We want to use four Solr servers as a SolrCloud, each with two cores
(\'collection1\' and \'webgraph\'). We create subdirectories for the
servers inside of /var/lib/tomcat6/yacyindex:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[mkdir /var/lib/tomcat6/yacyindex/solr0]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[mkdir /var/lib/tomcat6/yacyindex/solr1]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[mkdir /var/lib/tomcat6/yacyindex/solr2]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[mkdir /var/lib/tomcat6/yacyindex/solr3]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[In each of these directories, put a file named solr.xml. The
description for the creation of that file in the web is mainly void,
since there is a new
\[\[http://wiki.apache.org/solr/Solr.xml%204.4%20and%20beyond xml
structure for solr.xml for Solr 4.4 and beyond\]\], especially for
\[\[http://wiki.apache.org/solr/Core%20Discovery%20%284.4%20and%20beyond%29
Core Discovery with SolrCloud\]\]. Put the following content into each
of the four solr.xml:]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[\<?xml version=\"1.0\" encoding=\"UTF-8\" ?\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[\<solr persistent=\"false\" zkHost=\"localhost:2181\"\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[  \<int name=\"coreLoadThreads\"\>4\</str\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[  \<solrcloud\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<int name=\"distribUpdateConnTimeout\"\>30000\</int\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<int name=\"distribUpdateSoTimeout\"\>15000\</int\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<str name=\"host\"\>\${host:}\</str\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<int name=\"hostPort\"\>8080\</int\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<str name=\"hostContext\"\>solr0\</str\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<int name=\"leaderVoteWait\"\>15000\</int\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<int name=\"zkClientTimeout\"\>30000\</int\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<str name=\"zkHost\"\>localhost:2181\</str\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[  \</solrcloud\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[  \<shardHandlerFactory name=\"shardHandlerFactory\"
class=\"HttpShardHandlerFactory\"\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<int
name=\"socketTimeout\"\>\${socketTimeout:0}\</int\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[    \<int name=\"connTimeout\"\>\${connTimeout:0}\</int\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[  \</shardHandlerFactory\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[\</solr\>]{.underline}
</div>
<p> </p>
<p> </p>
<p>−</p>
<div>
===== ~~YaCy Installation~~ ===~~==~~
</div>
<p>+</p>
<div>
[To deploy Solr with the YaCy configuration you must create a Tomcat
Context fragment for each Solr instance. A Tomcat Context Fragment is a
file in /var/lib/tomcat6/conf/Catalina/localhost. Therefore, we must
create four files, one for each Solr server, in this directory: write a
file to /var/lib/tomcat6/conf/Catalina/localhost/solr0.xml with the
following content:]{.underline}
</div>
<p>−</p>
<div>
~~Download a YaCy tarball from http:~~//~~yacy.net or from an update
server like http:~~//~~latest.yacy.net~~
</div>
<p>+</p>
<div>
[\<?xml version]{.underline}=[\"1.0\"
encoding]{.underline}=[\"utf-8\"?\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[\<Context
docBase]{.underline}=[\"/home/administrator/tomcat/solr-4.5.1.war\"
debug]{.underline}=[\"0\"
crossContext]{.underline}=[\"true\"\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[  \<Environment name]{.underline}=[\"solr/home\"
type]{.underline}=[\"java.lang.String\"
value]{.underline}=[\"]{.underline}/[home]{.underline}/[administrator]{.underline}/[tomcat]{.underline}/[yacyindex\"
override=\"true\"/\>]{.underline}
</div>
<p> </p>
<p>+</p>
<div>
[\</Context\>]{.underline}
</div>
</div>
</div>
</div>
<script src="js/ui.js"></script>
</body>
</html>
